---
import { Icon } from 'astro-icon/components';

interface Props {
  defaultUrl?: string;
}

const { defaultUrl = "" } = Astro.props;
---

<div class="qr-controls space-y-4 w-full">
  <!-- URL Input -->
  <div class="form-group">
    <label for="qr-url" class="block mb-2 font-heading text-md font-bold" style="color: var(--biolink-body-text-color)">
      URL to encode
    </label>
    <input
      type="url"
      id="qr-url"
      value={defaultUrl}
      placeholder="https://your-website.com"
      required
      class="w-full px-4 py-3 neo-border rounded-lg bg-white focus:outline-none font-courier-prime"
      style="color: var(--biolink-input-text); border-color: var(--biolink-input-border);"
    />
  </div>

  <!-- Size Selector -->
  <div class="form-group">
    <label for="qr-size" class="block mb-2 font-heading text-md font-bold" style="color: var(--biolink-body-text-color)">
      QR Code Size
    </label>
    <select
      id="qr-size"
      class="w-full px-4 py-3 neo-border rounded-lg bg-white focus:outline-none font-courier-prime cursor-pointer"
      style="color: var(--biolink-input-text); border-color: var(--biolink-input-border);"
    >
      <option value="256">256x256 pixels</option>
      <option value="512" selected>512x512 pixels</option>
      <option value="1024">1024x1024 pixels</option>
    </select>
  </div>

  <!-- Generate Button -->
  <div class="form-group">
    <button
      type="button"
      id="qr-generate-btn"
      class="w-full py-3 px-6 font-heading text-md rounded-lg font-bold neo-button flex items-center justify-center gap-3"
      style="background-color: var(--biolink-primary-button-background); color: var(--biolink-primary-button-text);"
    >
      <Icon name="tabler:qrcode" class="w-6 h-6" />
      <span>Generate QR Code</span>
    </button>
  </div>
</div>

<script>
  const urlInput = document.getElementById('qr-url') as HTMLInputElement;
  const sizeSelect = document.getElementById('qr-size') as HTMLSelectElement;
  const generateBtn = document.getElementById('qr-generate-btn') as HTMLButtonElement;

  function emitGenerateEvent() {
    const url = urlInput.value.trim();
    const size = parseInt(sizeSelect.value);

    console.log('🔄 QrCodeGeneratorControls: Generate button clicked');
    console.log('📝 URL:', url);
    console.log('📏 Size:', size);

    if (url) {
      console.log('✅ QrCodeGeneratorControls: Dispatching qr-generate event on document');
      document.dispatchEvent(new CustomEvent('qr-generate', {
        detail: { url, size },
        bubbles: true
      }));
      console.log('📡 QrCodeGeneratorControls: Event dispatched successfully');
    } else {
      console.log('❌ QrCodeGeneratorControls: No URL provided, skipping event dispatch');
    }
  }

  generateBtn?.addEventListener('click', emitGenerateEvent);
</script>