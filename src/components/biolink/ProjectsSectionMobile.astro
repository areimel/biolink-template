---
import Heading from './Heading.astro';
import ProjectCard from './ProjectCard.astro';
import { Swiper, SwiperWrapper, SwiperSlide } from "astro-swiper";

interface Props {
  projectLinks: Array<{
    title: string;
    url: string;
    icon?: string;
    thumbnail?: string;
    imagePlaceholder?: boolean;
    description: string;
    technologies: string[];
    type: string;
    published?: boolean;
  }>;
}

const { projectLinks } = Astro.props;

// Filter projects to only show published ones
const publishedProjects = projectLinks.filter(project => project.published === true || project.published === undefined);

// Mobile-specific Swiper options
const mobileOptions = {
  // Single slide view for mobile
  slidesPerView: 1,
  spaceBetween: 16,
  centeredSlides: true,
  
  // Pagination with dynamic bullets
  pagination: {
    clickable: true,
    dynamicBullets: true,
    dynamicMainBullets: 5,
  },
  
  // Auto height for varying card sizes
  autoHeight: true,
  
  // Touch optimization
  grabCursor: true,
  touchRatio: 1.5,
  
  // Responsive breakpoints optimized for mobile
  breakpoints: {
    320: {
      slidesPerView: 1,
      spaceBetween: 12,
      centeredSlides: true,
    },
    480: {
      slidesPerView: 1.1,
      spaceBetween: 16,
      centeredSlides: true,
    },
    640: {
      slidesPerView: 1.3,
      spaceBetween: 20,
      centeredSlides: true,
    },
    768: {
      slidesPerView: 1.5,
      spaceBetween: 24,
      centeredSlides: true,
    }
  },
  
  // Performance optimizations
  watchOverflow: true,
  observer: true,
  observeParents: true,
};
---

{publishedProjects && publishedProjects.length > 0 && (
  <div class="w-full mobile-projects-section">
    <div class="neo-container p-4" style="background-color: var(--biolink-section-background); color: var(--biolink-body-text-color);">
      <Heading text="My Projects" />
      
      <div class="projects-carousel-wrapper mt-4">
        <div class="projects-swiper">
          <Swiper options={mobileOptions}>
            <SwiperWrapper>
              {publishedProjects.map(project => (
                <SwiperSlide class="project-slide">
                  <div class="project-card-container">
                    <ProjectCard {...project} />
                  </div>
                </SwiperSlide>
              ))}
            </SwiperWrapper>
          </Swiper>
        </div>
      </div>
      
      <!-- Slide indicator text -->
      <div class="text-center mt-2 text-xs font-mono" style="color: var(--biolink-body-text-color);">
        Swipe to explore projects
      </div>
    </div>
  </div>
)}

<style>
  .mobile-projects-section {
    /* Ensure proper spacing and layout */
    margin-bottom: 1rem;
  }
  
  .projects-carousel-wrapper {
    /* Container for carousel with proper spacing */
    margin: 0 -0.5rem;
    padding: 0 0.5rem;
  }
  
  .project-card-container {
    /* Wrapper for individual project cards in carousel */
    width: 100%;
    height: auto;
    display: flex;
    align-items: stretch;
  }
  
  /* Ensure project cards fill the slide */
  .project-card-container :global(.neo-card) {
    width: 100%;
    margin: 0;
  }
  
  /* VHS-themed carousel enhancements */
  :global(.projects-swiper) {
    padding-bottom: 3rem;
  }
  
  /* Custom pagination styling for projects */
  :global(.projects-swiper .swiper-pagination) {
    bottom: 0 !important;
  }
  
  :global(.projects-swiper .swiper-pagination-bullet) {
    background: var(--theme-surface, #fff) !important;
    border: 2px solid var(--theme-primary, #000) !important;
    width: 10px !important;
    height: 10px !important;
    border-radius: 2px !important;
    margin: 0 3px !important;
  }
  
  :global(.projects-swiper .swiper-pagination-bullet-active) {
    background: var(--theme-accent, #ff6b6b) !important;
    border-color: var(--theme-accent, #ff6b6b) !important;
    box-shadow: 0 0 6px var(--theme-accent, #ff6b6b) !important;
  }
  
  /* Dark mode pagination */
  
  /* Slide transition effects */
  :global(.projects-swiper .swiper-slide) {
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  
  :global(.projects-swiper .swiper-slide:not(.swiper-slide-active)) {
    opacity: 0.7;
    transform: scale(0.95);
  }
  
  /* Mobile-specific adjustments */
  @media (max-width: 480px) {
    .projects-carousel-wrapper {
      margin: 0 -0.25rem;
      padding: 0 0.25rem;
    }
    
    :global(.projects-swiper .swiper-pagination-bullet) {
      width: 8px !important;
      height: 8px !important;
      margin: 0 2px !important;
    }
  }
  
  /* Ensure touch-friendly interaction */
  :global(.project-slide) {
    cursor: grab;
  }
  
  :global(.project-slide:active) {
    cursor: grabbing;
  }
</style>