---
// ContactForm component using Web3Forms for submission
import { Icon } from 'astro-icon/components';

// Replace with your actual Web3Forms access key
const WEB3FORMS_ACCESS_KEY = "YOUR_ACCESS_KEY_HERE";
---

<style>
  .contact-form-input:focus {
    border-color: var(--biolink-input-focus-border) !important;
  }
  
  .contact-form-submit:hover {
    background-color: var(--biolink-input-focus-border) !important;
  }
  
  .contact-form-checkbox {
    color: var(--biolink-input-focus-border);
  }
  
  .contact-form-checkbox:focus {
    ring-color: var(--biolink-input-focus-border);
  }
</style>

<form 
  action="https://api.web3forms.com/submit" 
  method="POST" 
  class="space-y-4 w-full"
  id="contact-form"
>
  <!-- Web3Forms Access Key -->
  <input type="hidden" name="access_key" value={WEB3FORMS_ACCESS_KEY} />
  
  <!-- Optional: Subject field -->
  <input type="hidden" name="subject" value="New Contact Form Submission from Bio Link" />
  
  <!-- Name field -->
  <div class="form-group">
    <label for="name" class="block mb-1 font-heading text-md" style="color: var(--biolink-body-text-color)">Name</label>
    <input 
      type="text" 
      name="name" 
      id="name" 
      required 
      class="w-full px-4 py-2 neo-border rounded-lg bg-white contact-form-input focus:outline-none"
      style="color: var(--biolink-input-text)"
    />
  </div>
  
  <!-- Email field -->
  <div class="form-group">
    <label for="email" class="block mb-1 font-heading text-md" style="color: var(--biolink-body-text-color)">Email</label>
    <input 
      type="email" 
      name="email" 
      id="email" 
      required 
      class="w-full px-4 py-2 neo-border rounded-lg bg-white contact-form-input focus:outline-none"
      style="color: var(--biolink-input-text)"
    />
  </div>
  
  <!-- Message field -->
  <div class="form-group">
    <label for="message" class="block mb-1 font-heading text-md" style="color: var(--biolink-body-text-color)">Message</label>
    <textarea 
      name="message" 
      id="message" 
      rows="4" 
      required 
      class="w-full px-4 py-2 neo-border rounded-lg bg-white contact-form-input focus:outline-none"
      style="color: var(--biolink-input-text)"
    ></textarea>
  </div>
  
  <!-- Consent checkbox -->
  <div class="form-group">
    <label class="flex items-start gap-2 cursor-pointer">
      <input 
        type="checkbox" 
        name="consent" 
        required 
        class="mt-1 h-5 w-5 contact-form-checkbox rounded-none"
        style="border-color: var(--biolink-border-color);"
      />
      <span class="text-xs font-courier-prime" style="color: var(--biolink-body-text-color)">
        I consent to having this website store my submitted information so they can respond to my inquiry.
      </span>
    </label>
  </div>
  
  <!-- Honeypot field to prevent spam -->
  <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />
  
  <!-- Submit button -->
  <div class="form-group">
    <button 
      type="submit" 
      class="w-full py-3 px-6 font-heading text-md rounded-lg contact-form-submit font-medium neo-button flex items-center justify-center gap-2"
      style="background-color: var(--biolink-input-focus-border); color: var(--biolink-body-text-color)"
    >
      <span>Send Message</span>
      <Icon name="tabler:send" class="w-8 h-8" />
    </button>
  </div>
  
  <!-- Success/error message container -->
  <div id="result" class="mt-3 text-center hidden">
    <p id="success" class="text-green-600 hidden p-2 neo-border border-green-600">
      <Icon name="tabler:check" class="w-8 h-8 inline" />
      <span>Your message has been sent successfully!</span>
    </p>
    <p id="error" class="text-red-600 hidden p-2 neo-border border-red-600">
      <Icon name="tabler:alert-triangle" class="w-8 h-8 inline" />
      <span>Something went wrong. Please try again.</span>
    </p>
  </div>
</form>

<script>
  // Handle form submission
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const result = document.getElementById('result');
    const successMessage = document.getElementById('success');
    const errorMessage = document.getElementById('error');
    
    if (form && result && successMessage && errorMessage) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        const object = Object.fromEntries(formData);
        const json = JSON.stringify(object);
        
        // Show loading state
        form.querySelector('button')!.innerHTML = 'Please wait...';
        form.querySelector('button')!.disabled = true;
        
        fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: json
        })
        .then(async (response) => {
          const json = await response.json();
          result.classList.remove('hidden');
          
          if (response.status == 200) {
            // Show success message
            successMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            // Reset form
            form.reset();
          } else {
            // Show error message
            errorMessage.classList.remove('hidden');
            successMessage.classList.add('hidden');
            console.log(json);
          }
        })
        .catch(error => {
          // Show error message
          result.classList.remove('hidden');
          errorMessage.classList.remove('hidden');
          successMessage.classList.add('hidden');
          console.log(error);
        })
        .finally(() => {
          // Reset button state
          const submitBtn = form.querySelector('button')! as HTMLButtonElement;
          submitBtn.innerHTML = `
            <span>Send Message</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
              <path d="M10 14l11 -11"></path>
              <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5"></path>
            </svg>
          `;
          submitBtn.disabled = false;
        });
      });
    }
  });
</script> 